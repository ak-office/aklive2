
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PS PLAY - LINK</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/shaka-player.ui.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.6/controls.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="https://psplay.site/ps/ps_data.css" crossorigin="anonymous">       
</head>
<body>
    <div id="playerContainer" data-shaka-player-container style="position: relative;">
    <video data-shaka-player id="video" style="width:100%; height:100%;" autoplay
           poster="https://i.ibb.co/Tt7JCk9/20241113-111016.png">
    </video>
</div>
     <div id="myModal" class="modal" style="display: flex;">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h2>Join Our Telegram Channel</h2>
      <p>Stay updated with the latest streams and news.</p>
      <div class="modal-buttons">
        <button id="joinChannel">JOIN NOW</button>
        <button id="alreadyJoined">Close</button>
      </div>
    </div>
  </div>
    <script>
async function init() {
    // Get channel ID from URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    const channelId = urlParams.get('id');
    
    if (!channelId) {
        alert('Missing or invalid channel ID.');
        return;
    }

    try {
        // Fetch video data
        const response = await fetch(`https://psplay.site/ps/getData_pslive.php?id=${channelId}`);
        if (!response.ok) throw new Error('Failed to fetch channel data');
        
        const { data, error } = await response.json();
        if (error) throw new Error(error);

        // Decrypt the fetched data
        const decryptedData = decryptData(data);
        const videoData = JSON.parse(decryptedData);
        
        const videoUrl = videoData.url;
        const clearKey1 = videoData.clearKey || '';
        const clearKey2 = videoData.clearKey2 || '';
        const licenseUrl = videoData.license || '';

        // Initialize Shaka Player
        const playerContainer = document.getElementById('playerContainer');
        const player = playerContainer.ui;
        const videoElement = player.getControls().getPlayer();
        
        // Configure player UI
        const uiConfig = {
            controlPanelElements: [
                'play_pause',
                'time_and_duration',
                'spacer',
                'fullscreen',
                'picture_in_picture',
                'quality'
            ],
            seekBarColors: {
                base: 'rgba(255, 255, 255, 0.5)',
                buffered: 'rgba(128, 128, 128, 0.7)',
                played: 'rgb(66, 133, 244)'
            },
            volumeBarColors: {
                base: 'rgba(255, 255, 255, 0.5)',
                level: 'rgb(66, 133, 244)'
            }
        };
        player.configure(uiConfig);

        // Configure DRM if clear keys are provided
        if (clearKey1 && clearKey2) {
            videoElement.configure({
                drm: {
                    clearKeys: {
                        [clearKey1]: clearKey2
                    }
                }
            });
        }

        // Set up license server for DRM if provided
        if (licenseUrl) {
            videoElement.getNetworkingEngine().registerRequestFilter((type, request) => {
                if (type === shaka.net.NetworkingEngine.RequestType.LICENSE ||
                    type === shaka.net.NetworkingEngine.RequestType.MANIFEST) {
                    request.headers['Authorization'] = `Bearer ${licenseUrl}`;
                }
            });
        }

        // Load the video
        await videoElement.load(videoUrl);
        console.log('Video loaded!');

        // Handle control bar visibility
        const controls = player.getControls().getControlsContainer();
        const fadeDelay = 1000; // 1 second
        let fadeTimeout;

        function toggleControls() {
            clearTimeout(fadeTimeout);
            controls.classList.add('display');
            fadeTimeout = setTimeout(() => {
                controls.classList.remove('display');
            }, fadeDelay);
        }

        // Add event listeners for control bar visibility
        document.getElementById('video').addEventListener('mousemove', toggleControls);
        controls.addEventListener('mouseover', toggleControls);
        controls.addEventListener('click', toggleControls);
        toggleControls();

        // Log player errors
        videoElement.addEventListener('error', (event) => console.error('Player error:', event));

    } catch (error) {
        console.error('Error:', error);
        alert(`Error: ${error.message}`);
    }
}

// Decrypt data using AES
function decryptData(encryptedData) {
    const key = CryptoJS.enc.Utf8.parse('2ec7352cfc575a7f800fa95a2ed6d116c4b0');
    const iv = CryptoJS.enc.Utf8.parse('2f0af185c7d6d116c4b0');
    const decrypted = CryptoJS.AES.decrypt(
        { ciphertext: CryptoJS.enc.Base64.parse(encryptedData) },
        key,
        { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
    );
    return decrypted.toString(CryptoJS.enc.Utf8);
}

// Modal handling functions
function showModal() {
    document.getElementById('myModal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('myModal').style.display = 'none';
}

function redirectToTelegram() {
    window.open('https://telegram.me/joinChannel', '_blank');
    closeModal();
}

// Event listeners for modal interactions
document.getElementById('joinChannel').addEventListener('click', redirectToTelegram);
document.getElementById('closeModal').addEventListener('click', closeModal);
document.getElementById('alreadyJoined').addEventListener('click', closeModal);
document.addEventListener('DOMContentLoaded', showModal);
document.addEventListener('shaka-ui-loaded', init);
    </script>
</body>
</html>
